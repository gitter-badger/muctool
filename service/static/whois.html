<!DOCTYPE html>
<!--
  ~ MUCtool Web Toolkit
  ~
  ~ Copyright 2017 Alexander Orlov <alexander.orlov@loxal.net>. All rights reserved.
  ~
  ~ This program is free software: you can redistribute it and/or modify
  ~ it under the terms of the GNU Affero General Public License as published
  ~ by the Free Software Foundation, either version 3 of the License, or
  ~ (at your option) any later version.
  ~
  ~ This program is distributed in the hope that it will be useful,
  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  ~ GNU Affero General Public License for more details.
  ~
  ~ You should have received a copy of the GNU Affero General Public License
  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.
  -->

<html lang="en">
<meta charset="utf-8">
<meta name="description" content="Provides GeoIP and other meta data about an IPv4 or an IPv6 address.">
<script src="build/runtime/kotlin.js"></script>
<script src="build/client.js"></script>
<script>
    "use strict";
    if (location.search.indexOf("standalone") === -1) {
        client.net.loxal.muctool.client.loadPageIntoContainer();
    }

    var whois = async function () {
        const ipAddress = document.getElementById("ipAddress").value;
        const queryIP = "&queryIP=" + ipAddress;
        const xhr = new XMLHttpRequest();
        xhr.open("GET", "/whois?clientId=f5c88067-88f8-4a5b-b43e-bf0e10a8b857" + queryIP);
        xhr.onload = async function () {
            if (this.status === 200) {
                const whoisInfo = JSON.parse(this.responseText);
                client.net.loxal.muctool.client.clearPreviousWhoisView();
                const whoisContainer = document.createElement("dl");
                document.getElementById("whois").appendChild(whoisContainer);
                const promiseContainer = client.net.loxal.muctool.client.traverse(whoisContainer, whoisInfo, client.net.loxal.muctool.client.process);
            } else {
                client.net.loxal.muctool.client.clearPreviousWhoisView();
                document.getElementById("ipAddress").value = "185.17.205.98";
                document.getElementById("ipAddress").onchange();
                document.getElementById("status").textContent =
                    "Your IP address was not found. Another, known IP address was used.";
            }
        };
        xhr.send();
    };
</script>

<title>GeoIP Whois</title>

<body onload="client.net.loxal.muctool.client.init(); whois()">
<h1>GeoIP Whois</h1>

<p>Provides GeoIP and other meta data about an IPv4 or an IPv6 address.</p>

<!--TODO remove title & alt attributes from ipAddress input if they do not improve Audit results-->
<input id="ipAddress" type="search" title="IPv4 / IPv6 address"
       onchange="whois()" placeholder="IPv4 / IPv6 address"
       style="width: 310px; font-weight: bold;">

<div id="status"></div>
<div id="whois" class="compact"></div>